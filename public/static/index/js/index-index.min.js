$(document).ready(function(){var m=0,u=0,p=1,i=10,o=0;$(".ETHcount").text(10);var h,b,v,n,a,s=10,g=[],w=echarts.init(document.getElementById("mychart"));document.domain;function r(){var e={name:u,value:[u,p.toFixed(2)]};return m+=.04,$(".showmultiple").html(p.toFixed(2)),p=m/2+(Math.pow(m,2)-m)/10+1,e}function f(e){$(".boomImg").show(),$(".multiple").hide(),$(".explosion").show(),$(".showexplosion").html(e),function(){$(".rock").hide(),$(".rock1").show();var e=setTimeout(function(){clearTimeout(e),$(".rock1").hide()},2e3)}(),clearInterval(h),u=m=0,p=1,(w=echarts.init(document.getElementById("mychart"))).setOption(option)}function e(){$('input[name="balance"]').val(),parseFloat(userCoin.jackpot);return 1}function x(){n=8,$(".rock").hide();var t=setInterval(function(){if(n=(n-=.1).toFixed(1),$(".startTime").html(n),n<=0){clearInterval(t),document.getElementById("ReductionEth").disabled=!0,document.getElementById("addEth").disabled=!0,$(".rank").click(function(){window.location.href=""}),$(".btn-betting").html("逃跑倒计时"),$(".countdown").hide(),a=4;var e=setInterval(function(){--a,$(".gamedown").show(),$(".startTime1").html("<span style='text-align:center;display: block;color: #ffffff; font-size: 50px' >"+a+"</span>"),a<1&&(clearInterval(e),document.getElementById("btn-betting").disabled=!1,document.getElementById("ReductionEth").disabled=!1,document.getElementById("addEth").disabled=!1,$(".gamedown").hide(),$(".countdown").hide(),$(".multiple").show(),$(".rock").show(),3==$('input[name="betbtn"]').val()?$(".btn-betting").removeClass("checked"):$(".btn-betting").addClass("checked"),$(".btn-betting").html("逃跑"),$(".btn-betting").hasClass("escape-btn")?$('input[name="betbtn"]').val(5):2!=$('input[name="betbtn"]').val()&&3!=$('input[name="betbtn"]').val()&&$('input[name="betbtn"]').val(0),1!=p&&0!=p&&window.location.reload(),g.splice(0,g.length),h=setInterval(function(){g.push(r()),w.setOption(option),u=+(u+=.1).toFixed(1)},100),w.setOption(option))},1e3)}},100)}function y(e){var t,n,a=Math.random(),i='<div class="winperson" id= "winperson'+a+'"><p>●</p><p>'+e+"</p></div>";$(".mask").append(i),t="winperson"+a,(n=document.getElementById(t)).addEventListener("animationend",function(e){n.parentNode.removeChild(n)})}$.ajax({type:"post",url:"/cron/bet/lastKj",dataType:"json",success:function(e){$(".show-record span:eq(0)").html(e[0].id),$(".show-record span:eq(1)").html(e[0].rate+"x"),$(".show-record span:eq(2)").html(e[1].id),$(".show-record span:eq(3)").html(e[1].rate+"x"),$(".show-record span:eq(4)").html(e[2].id),$(".show-record span:eq(5)").html(e[2].rate+"x"),$(".show-record span:eq(6)").html(e[3].id),$(".show-record span:eq(7)").html(e[3].rate+"x"),$(".show-record span:eq(8)").html(e[4].id),$(".show-record span:eq(9)").html(e[4].rate+"x")}}),$("#addEth").on("click",function(){200<=s?$(".ETHcount").html(200):e(s+=i)&&$(".ETHcount").html(s.toFixed(2))}),$("#ReductionEth").on("click",function(){s<=10||e(s-=i)&&$(".ETHcount").html(s.toFixed(2))}),$(".min-btn").on("click",function(){e(s=10)&&$(".ETHcount").html(s.toFixed(2))}),$(".max-btn").on("click",function(){$(".ETHcount").html(200)}),option={grid:{top:"15%",left:"3%",right:"4%",bottom:"5%",containLabel:!0},xAxis:{type:"value",boundaryGap:!1,axisLine:{lineStyle:{color:"#464F6A"}},max:function(e){var t=10;return e.max>t&&(t=e.max),t},axisTick:{inside:!0,show:!0},axisLabel:{inside:!0,formatter:"{value}s",show:!0,showMinLabel:!1,showMaxLabel:!1,fontSize:9},naocation:"middle",splitLine:{show:!1},position:"bottom"},yAxis:{type:"value",scale:!0,axisLine:{lineStyle:{color:"#464F6A"}},boundaryGap:!1,min:1,max:function(e){var t=4.5;return e.max>t&&(t=e.max),t},axisLabel:{inside:!0,formatter:"{value}x",showMinLabel:!1,showMaxLabel:!1,fontSize:9},axisTick:{inside:!0,show:!0},splitLine:{show:!1,lineStyle:{color:"#303542"}}},series:[{name:"爆点",areaStyle:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(255, 255, 255,0.3)"},{offset:1,color:"rgba(255, 255, 255,0.05)"}])},type:"line",showSymbol:!1,hoverAnimation:!1,data:g,itemStyle:{color:"cornflowerblue"}}]},document.addEventListener("visibilitychange",function(){document.hidden}),w.setOption(option),$(".select-head").on("click",function(){$(this).next().slideToggle(),$(".thearrow1").toggle(),$(".thearrow2").toggle()}),$(".select-body").on("click",".select-item",function(){var e='<span class="my-balance">'+$(this).children("span").html()+"</span>",t=$($(this).children("img")[0]).attr("src");$(".select-head-img").attr("src",t),$(".select-head").html('<img class="select-head-img" src="'+t+'" alt=""> '+e+'<div class="thearrow thearrow1"></div><div class="thearrow thearrow2" style="display: none"></div>'),$(".select-body").slideToggle(),o=$(this).attr("key");var n=$(this).attr("coin-id");$('input[name="coinid"]').val(n),$(".jackpot-balance").html(parseFloat(userCoin[o].jackpot).toFixed(2)),i=userCoin[o].step,s=userCoin[o].step,$(".stake-num").html(i),$(".stake-coin").html(userCoin[o].coin_en_name);var a=userCoin[o].coin_price;parseFloat(a*i).toFixed(2)}),$(".closeshare").on("click",function(){$(".tocharge").css("visibility","hidden"),$(".toshare").css("visibility","hidden")});var k,l=!0;$(".btn-betting").on("click",function(){var e=$('input[name="betbtn"]').val(),t=$('input[name="memberid"]').val(),n=($('input[name="nickname"]').val(),$('input[name="pointid"]').val()),a=$(".ETHcount").html(),i=(userCoin.coin_en_name,$(this));if($(this).hasClass("escape-btn")){if(!l)return;if(4==e)return void toast({message:"请不要频繁操作！",type:"error",duration:1e3});if(6==e)return void toast({message:"您已经逃跑成功！",type:"error",duration:1e3});if(3==e)return void toast({message:"请等待游戏开始",type:"error"});if(5!=e)return void toast({message:"请等待下一局",type:"error"});var o=p.toFixed(2);if(1==o)return;l=!1;var s=null;$.ajax({url:"/cron/bet/escape",type:"post",data:{user_id:t,pointid:n,multiple:o},dataType:"json",success:function(e){s=e,console.log(s),l=!0,0==e.status?(toast({message:"逃跑成功！",type:"success",duration:1e3}),$('input[name="betbtn"]').val(6),$(".btn-betting").html("逃跑成功"),$(".btn-betting").addClass("checked")):($('input[name="betbtn"]').val(3),toast({message:e.info,type:"error",duration:1e3}))}})}else{if(2==e)return;if(3==e)return void toast({message:"请不要频繁操作！",type:"error"});if(0==n||0==e)return;$('input[name="betbtn"]').val(2);$.ajax({type:"post",url:"/cron/bet/bets",data:{bet:a,user_id:t,pointid:n},dataType:"json",success:function(e){0==(s=e).status?(toast({duration:1e3,message:"下单成功！",type:"success"}),$(".btn-betting").html("已下单"),$(".btn-betting").addClass("checked"),$('input[name="betbtn"]').val(3),$(".yue").html(parseFloat(e.data).toFixed(2)),i.addClass("escape-btn")):10003==e.status||(10002==e.status?($('input[name="betbtn"]').val(1),$(".toshare").css("visibility","visible")):10001==e.status&&(toast({message:"您的余额已不足，请充值",type:"error"}),$('input[name="betbtn"]').val(1)))}})}}),$(".reconnection").siblings().hide(),function(){n=0;var e=setInterval(function(){$(".countdown").hide(),$(".multiple").show(),$(".rock").show(),clearInterval(e),3==$('input[name="betbtn"]').val()?$(".btn-betting").removeClass("checked"):$(".btn-betting").addClass("checked"),$(".btn-betting").html("等待下一局"),$(".btn-betting").hasClass("escape-btn")?$('input[name="betbtn"]').val(5):2!=$('input[name="betbtn"]').val()&&3!=$('input[name="betbtn"]').val()&&$('input[name="betbtn"]').val(0),g.splice(0,g.length),k=setInterval(function(){g.push(r()),w.setOption(option),u=+(u+=.1).toFixed(1)},100)},100)}();new Base64;function F(){$(".showmultiple").text("")}function c(e){new Base64;var t=JSON.parse(e.data);if(t)switch(console.info(t),t.type){case"ping":ws.send("ping");break;case"bets":if(1==t.is_list){var n=t.list,a=n.length,i=0;v=setInterval(function(){a-1<=i&&clearInterval(v);var e='<tr class="member_'+n[i].memberid+'">';e+='<td><img style="height: 0.15rem; width: 0.15rem; margin-right: 5px; border-radius: 50%;" src="'+n[i].head_url+'" />'+n[i].nickname+"</td>",e+="<td>-</td>",e+="<td>"+parseInt(n[i].bet)+".00元</td>",e+="<td>-</td>",e+="</tr>",$(".user-bets").append(e),i++},800)}else{var o='<tr class="member_'+t.memberid+'">';o+='<td><img style="height: 0.15rem; width: 0.15rem; margin-right: 5px; border-radius: 50%;" src="'+t.head_url+'" />'+t.nickname+"</td>",o+="<td>-</td>",o+="<td>"+parseInt(t.bet)+".00元</td>",o+="<td>-</td>",o+="</tr>",$(".user-bets").append(o)}break;case"escape":if(clearInterval(v),1==t.is_list){var s=t.list;function r(e){setTimeout(function(){void 0!==$(".user-bets tr:eq(1)").html()&&(console.log("escape:",e),y(e.user_name+"@"+parseFloat(e.escape).toFixed(2)+"倍"),$(".member_"+e.uid).addClass("win"),$(".member_"+e.uid+" td").eq(1).html(e.escape+"倍"),$(".member_"+e.uid+" td").eq(3).html((parseFloat(e.escape)*parseInt($(".member_"+e.uid+" td").eq(2).text())).toFixed(2)))},e.setTime)}for(var l in s)r(s[l])}else{if(y(t.user_name+"@"+parseFloat(t.escape).toFixed(2)+"倍"),t.uid==$('input[name="memberid"]').val()){var c=parseFloat($(".yue").text())+parseFloat(t.bet)*parseFloat(t.escape);$(".yue").html(c.toFixed(2)),$('input[name="betbtn"]').val(6),$(".btn-betting").html("逃跑成功"),$(".btn-betting").addClass("checked")}$(".member_"+t.uid).addClass("win"),$(".member_"+t.uid+" td").eq(1).html(t.escape+"倍"),$(".member_"+t.uid+" td").eq(3).html((parseFloat(t.escape)*parseInt($(".member_"+t.uid+" td").eq(2).text())).toFixed(2))}break;case"begin":$("#box").hide(),clearInterval(k),clearInterval(h),u=m=0,p=1,g.splice(0,g.length),(w=echarts.init(document.getElementById("mychart"))).setOption(option),$(".btn-betting").removeClass("checked"),1!=$('input[name="doing"]').val()&&(setTimeout(function(){$(".btn-betting").removeClass("escape-btn"),$('input[name="doing"]').val(1),$('input[name="pointid"]').val(t.gid),$(".startTime").html(8),$(".btn-betting").html("下单"),$('input[name="betbtn"]').val(1),setTimeout("$('.countdown').show()",2e3),setTimeout("$('.multiple').hide()",2e3),setTimeout("$('.jackpot').show()",2e3),setTimeout("$('.explosion').hide()",2e3),$(".user-bets tr").each(function(e){0!=e&&$(this).remove()})},800),setTimeout(x,2e3)),setTimeout(F,3e3);break;case"over":$("#box").hide(),clearInterval(b),clearInterval(v),setTimeout(clearInterval(h),1e3),0!=$('input[name="doing"]').val()&&(f(t.boom),$(".btn-betting").removeClass("checked"),$('input[name="betbtn"]').val(1),$('input[name="doing"]').val(0),$(".btn-betting").removeClass("escape-btn"),$(".boomImg").hide(),$(".user-bets tr").each(function(e){0==e||$(this).hasClass("win")||$(this).addClass("lose")})),$(".show-record").children(".record-item").eq(0).hide(1e3),setTimeout("$('.show-record').children('.record-item').eq(0).remove()",1e3);o='<div class="record-item">';o+='<div class="c-t">',o+='<img src="/public/static/index/images/show-recod.png" alt="">',o+="<span>"+t.gid+"</span>",o+="</div>",t.boom<1.5?o+='<div class="c-b islow">':o+='<div class="c-b isheugh">',o+="<span>"+Math.ceil(100*t.boom)/100+"x</span>",o+="</div>",o+="</div>",$(".show-record").append(o);break;case"jackpotChange":var d=t;$(".jackpot-balance").html(parseFloat(d.rmb).toFixed(2)),userCoin.jackpot=parseFloat(d.rmb).toFixed(2);break;case"maxStake":d=t;userCoin.max_stake=parseFloat(d.rmb).toFixed(2)}else console.info("emptyResponse",e.data)}WEB_SOCKET_SWF_LOCATION="/public/static/public/swf/WebSocketMain.swf",WEB_SOCKET_DEBUG=!0,function e(){function t(){console.log("显示连接状态"),$(".reconnection").siblings().hide(),$(".reconnection").html("连接中..."),$(".reconnection").show()}var n=window.location.host;var a="https:"===window.location.protocol?"wss":"ws";var i=a+"://"+n+"/ws/";ws=new WebSocket(i);ws.onmessage=c;ws.onopen=function(e){var t=$('input[name="memberid"]').val(),n=$('input[name="nickname"]').val(),a='{"user_id":'+t+',"nickname":"'+n+'","type":"init"}',i=new Base64,o=i.encode(a);ws.send(o)};var o=(s=function(){t(),e()},r=5e3,function(){var e=arguments;l||(s.apply(this,e),l=!0,setTimeout(function(){l=!1},r))});var s,r,l;ws.onclose=function(e){o()};ws.onerror=function(){console.log("出现错误")}}()});